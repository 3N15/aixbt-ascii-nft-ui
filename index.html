<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AIXBT ASCII NFT Card – Interactive</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono&display=swap" rel="stylesheet">
  <style>
    /* your existing CSS */
  </style>
</head>
<body>
  <div class="controls">
    <button id="editTitle">Edit Title</button>
    <button id="editImage">Upload Image</button>
    <button id="editTweet">Edit Tweet</button>
    <button id="downloadBtn">Download PNG</button>
    <input type="file" id="uploadInput" accept="image/*" />
  </div>

  <div class="card" id="card">
    <!-- your ASCII card markup unchanged -->
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    window.onload = () => {
      const asciiEl    = document.getElementById('ascii');
      const uploadIn   = document.getElementById('uploadInput');
      const cardImg    = document.getElementById('cardImage');

      function getLines()   { return asciiEl.textContent.split('\\n'); }
      function updateLines(l) { asciiEl.textContent = l.join('\\n'); }
      function centerLine(t,i,l){
        const w   = l[i].length - 2;
        const pad = w - t.length;
        const lf  = Math.floor(pad/2), rt = pad - lf;
        l[i] = '|' + ' '.repeat(lf) + t + ' '.repeat(rt) + '|';
      }

      // … your editTitle and uploadImage handlers …

      // REWRITTEN “Edit Tweet”
      document.getElementById('editTweet').onclick = async () => {
        const raw = prompt('Paste full tweet URL:');
        if (!raw) return;

        // grab every numeric chunk, take the last one
        const allNums = raw.match(/\\d+/g);
        if (!allNums) {
          alert('No numeric ID found in URL.');
          return;
        }
        const tweetId = allNums[allNums.length - 1];

        try {
          const res = await fetch(`/api/tweet?id=${encodeURIComponent(tweetId)}`);
          const js  = await res.json();
          if (!res.ok || js.error) {
            throw new Error(js.error || `HTTP ${res.status}`);
          }

          const lines = getLines();
          centerLine(js.data.text.slice(0,37), 12, lines);
          const pm = js.data.public_metrics;
          centerLine(
            `C:${pm.reply_count} R:${pm.retweet_count} L:${pm.like_count} B:${pm.quote_count}`,
            18,
            lines
          );
          updateLines(lines);
        } catch (er) {
          alert('Error fetching tweet: ' + er.message);
        }
      };

      // … your downloadBtn handler …
    };
  </script>
</body>
</html>