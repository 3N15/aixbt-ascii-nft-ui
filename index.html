<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AIXBT ASCII NFT Card – Dynamic</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #0a0a0a;
      display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
      min-height: 100vh; font-family: 'Space Mono', monospace; color: #00ffff;
      padding: 20px;
    }
    .controls { margin-bottom: 16px; }
    .controls button {
      margin-right: 8px; margin-bottom: 8px;
      padding: 8px 16px; background: #00ffff; color: #0a0a0a;
      border: none; border-radius: 4px; cursor: pointer;
      font-family: 'Space Mono', monospace;
    }
    .controls button:hover { background: #33ffff; }
    .card {
      width: 360px; height: 560px; padding: 20px;
      background: linear-gradient(145deg,#111,#000);
      border-radius: 16px;
      box-shadow: 0 4px 8px rgba(0,255,255,0.2), 0 8px 16px rgba(0,255,255,0.1);
      position: relative; overflow: hidden;
    }
    /* Fixed 312×190 area for the image */
    .ascii-img {
      position: absolute; top: 106px; left: 24px;
      width: 312px; height: 190px; object-fit: cover; z-index: 1;
    }
    /* Pixel‑perfect ASCII overlay */
    .ascii {
      position: absolute; top: 20px; left: 24px;
      width: 312px; white-space: pre; letter-spacing: 0;
      font-size: 14px; line-height: 1.4; z-index: 2;
      color: #00ffff; cursor: text;
    }
    #uploadInput { display: none; }
  </style>
</head>
<body>
  <div class="controls">
    <button id="editTitle">Edit Title</button>
    <button id="editImage">Upload Image</button>
    <button id="editTweet">Edit Tweet</button>
    <button id="downloadBtn">Download PNG</button>
    <input type="file" id="uploadInput" accept="image/*" />
  </div>

  <div class="card" id="card">
    <img id="cardImage" src="placeholder.png" class="ascii-img" alt="content"/>
    <pre id="ascii" class="ascii">
+------------------------------------+
|        INSIDER WALLET DUMP         |
+------------------------------------+

+------------------------------------+
|                                    |
|                                    |
|                                    |
|                                    |
|                                    |
|                                    |
|                                    |
|                                    |
|                                    |
+------------------------------------+
|    #AIXBT-001    |    LEGENDARY    |
+------------------------------------+

+------------------------------------+
|                                    |
|                                    |
|                                    |
|                                    |
|                                    |
+------------------------------------+
| C:0    | R:0    | L:0     | B:0    |
+------------------------------------+
    </pre>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    const asciiEl = document.getElementById('ascii');
    let lines = asciiEl.innerText.split('\\n');

    function centerLine(text, idx) {
      const w = lines[idx].length - 2, pad = w - text.length;
      const l = Math.floor(pad/2), r = pad - l;
      lines[idx] = '|' + ' '.repeat(l) + text + ' '.repeat(r) + '|';
    }

    // Title
    document.getElementById('editTitle').onclick = () => {
      const t = prompt('New title:');
      if (t) { centerLine(t,1); asciiEl.innerText = lines.join('\\n'); }
    };

    // Image Upload
    document.getElementById('editImage').onclick = () => {
      document.getElementById('uploadInput').click();
    };
    document.getElementById('uploadInput').onchange = e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => document.getElementById('cardImage').src = reader.result;
      reader.readAsDataURL(file);
    };

    // Tweet fetch (via your /api/tweet endpoint)
    document.getElementById('editTweet').onclick = async () => {
      const url = prompt('Tweet URL:');
      if (!url) return;
      const id = url.split('/').pop();
      const res = await fetch(`/api/tweet?id=${id}`);
      const json = await res.json();
      if (res.ok && json.data) {
        centerLine(json.data.text.slice(0,37), 12);
        const m = json.data.public_metrics;
        const eng = `C:${m.reply_count} R:${m.retweet_count} L:${m.like_count} B:${m.quote_count}`;
        centerLine(eng, 18);
        asciiEl.innerText = lines.join('\\n');
      } else {
        alert('Error loading tweet');
      }
    };

    // Download PNG
    document.getElementById('downloadBtn').onclick = () => {
      html2canvas(document.getElementById('card')).then(canvas => {
        const a = document.createElement('a');
        a.download = 'aixbt_ascii_card.png';
        a.href = canvas.toDataURL('image/png');
        a.click();
      });
    };
  </script>
</body>
</html>
