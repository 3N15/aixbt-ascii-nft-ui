<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AIXBT ASCII NFT Card â€“ Interactive</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono&display=swap" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box }
    body {
      background: #0a0a0a;
      display: flex; flex-direction: column; align-items: center;
      padding: 20px; font-family: 'Space Mono', monospace; color: #00ffff;
    }
    .controls { margin-bottom: 16px; }
    .controls button {
      margin-right:8px; margin-bottom:8px;
      padding:8px 16px; background:#00ffff; color:#0a0a0a;
      border:none; border-radius:4px; cursor:pointer;
    }
    .controls button:hover { background:#33ffff; }
    .card {
      width:360px; height:560px; padding:20px;
      background:linear-gradient(145deg,#111,#000);
      border-radius:16px; box-shadow:0 4px 8px rgba(0,255,255,0.2),0 8px 16px rgba(0,255,255,0.1);
      position:relative; overflow:hidden;
    }
    .ascii-img { position:absolute; top:106px; left:24px; width:312px; height:190px; object-fit:cover; z-index:1; }
    .ascii {
      position:absolute; top:20px; left:24px; width:312px; white-space:pre;
      font-size:14px; line-height:1.4; letter-spacing:0; z-index:2; color:#00ffff; cursor:text;
    }
    #uploadInput { display:none; }
  </style>
</head>
<body>
  <div class="controls">
    <button id="editTitle">Edit Title</button>
    <button id="editImage">Upload Image</button>
    <button id="editTweet">Edit Tweet</button>
    <button id="downloadBtn">Download PNG</button>
    <input type="file" id="uploadInput" accept="image/*" />
  </div>
  <div class="card" id="card">
    <img id="cardImage" class="ascii-img"
         src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="
         alt="content">
    <pre id="ascii" class="ascii">
+------------------------------------+
|        INSIDER WALLET DUMP         |
+------------------------------------+

+------------------------------------+
|                                    |
|                                    |
|                                    |
|                                    |
|                                    |
|                                    |
|                                    |
|                                    |
|                                    |
+------------------------------------+
|    #AIXBT-001    |    LEGENDARY    |
+------------------------------------+

+------------------------------------+
|                                    |
|                                    |
|                                    |
|                                    |
|                                    |
+------------------------------------+
| C:0    | R:0    | L:0     | B:0    |
+------------------------------------+
    </pre>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    window.onload = function() {
      const asciiEl = document.getElementById('ascii');
      const upInput = document.getElementById('uploadInput');
      const cardImg = document.getElementById('cardImage');

      function getLines() { return asciiEl.textContent.split('\n'); }
      function updateLines(lines) { asciiEl.textContent = lines.join('\n'); }
      function centerLine(txt, i, lines) {
        const w = lines[i].length - 2, pad = w - txt.length;
        const lf = Math.floor(pad/2), rt = pad - lf;
        lines[i] = '|'+' '.repeat(lf)+txt+' '.repeat(rt)+'|';
      }

      document.getElementById('editTitle').onclick = () => {
        const t = prompt('Enter new title:'); if (!t) return;
        const l = getLines(); centerLine(t, 1, l); updateLines(l);
      };

      document.getElementById('editImage').onclick = () => upInput.click();
      upInput.onchange = e => {
        const f = e.target.files[0]; if (!f) return;
        const r = new FileReader();
        r.onload = () => cardImg.src = r.result;
        r.readAsDataURL(f);
      };

      document.getElementById('editTweet').onclick = async () => {
        const raw = prompt('Paste full tweet URL:'); if (!raw) return;

        let tweetId = null;
        try {
          const u = new URL(raw);
          const seg = u.pathname.split('/').filter(Boolean);
          const idx = seg.indexOf('status');
          if (idx >= 0 && seg[idx+1]) tweetId = seg[idx+1];
        } catch {}
        if (!tweetId) {
          const nums = raw.match(/\d+/g) || [];
          tweetId = nums.find(n => n.length > 10) || nums[0];
        }
        if (!tweetId) return alert('Cannot extract tweet ID.');

        try {
          const resp = await fetch(`/api/tweet?id=${tweetId}`);
          const js = await resp.json();
          if (resp.status === 429) return alert(js.error);
          if (!resp.ok) throw new Error(js.error || `HTTP ${resp.status}`);

          const l = getLines();
          const tweet = js.data.text?.slice(0, 37) || '[No tweet content]';
          centerLine(tweet, 12, l);
          const pm = js.data.public_metrics || {};
          const count = (v) => (typeof v === 'number' && v >= 0 ? v : 0);
          centerLine(
            `C:${count(pm.reply_count)} R:${count(pm.retweet_count)} L:${count(pm.like_count)} B:${count(pm.bookmark_count)}`,
            18, l
          );
          updateLines(l);
        } catch (er) {
          alert('Error fetching tweet: ' + er.message);
        }
      };

      document.getElementById('downloadBtn').onclick = () => {
        html2canvas(document.getElementById('card')).then(canvas => {
          const a = document.createElement('a');
          a.download = 'aixbt_ascii_card.png';
          a.href = canvas.toDataURL('image/png');
          a.click();
        });
      };
    };
  </script>
</body>
</html>
